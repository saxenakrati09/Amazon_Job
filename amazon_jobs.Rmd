---
title: "Amazon Jobs"
output: html_notebook
---

Let's check out the data!

```{r}
library(readr)
amazon <- read_csv("amazon_jobs_dataset.csv")
head(amazon)
```

Questions that we can focus on:
  - What are the popular locations of job openings?
  - Are there certain months when job opening are more? 
    - How many jobs are posted every year?
    - How many jobs are posted every month?
  - What are most popular job titles?
  - What are minimum educational qualifications?
    - Which job requires higher degree?
  - What languages are required for jobs?
  - How many years of experience is required?
    - Which job categories require more experience?
  - Word clouds of preferred qualifications
  - Word clouds of Basic Qualifications
  - Word clouds of JOb description

```{r}
dim(amazon)
```
```{r}
unique(amazon$Posting_date)
```

We see that in some dates, there are multiple spaces between month and day. Let's split it to year month and day.

```{r}
library(stringr)
amazon$posting_month <- str_extract(amazon$Posting_date , "([A-Za-z]+)")
amazon$posting_day <- str_extract(amazon$Posting_date , "([0-9]+)")
amazon$posting_year <- str_extract(amazon$Posting_date, "([0-9]{4})")
```

```{r}
unique(amazon$posting_month)
unique(amazon$posting_day)
unique(amazon$posting_year)
```
Let's also extract the countries from location column.

```{r}
amazon$country <- str_extract(amazon$location, "[A-Za-z]+")
unique(amazon$country)
```

```{r}
unique(amazon$location)
```

```{r}
amazon$city <- word(amazon$location, -1)
unique(amazon$city)
```

Let us correct the city names that have multiple words.
```{r}
amazon$city <- gsub(pattern = "Alto", replacement = "East Palo Alto", amazon$city)
amazon$city <- gsub(pattern = "Ia<U+015F>i", replacement = "Iasi", amazon$city)
amazon$city <- gsub(pattern = "Monica", replacement = "Santa Monica", amazon$city)
amazon$city <- gsub(pattern = "Francisco", replacement = "San Francisco", amazon$city)
amazon$city <- gsub(pattern = "Wroclawskie", replacement = "Bielany Wroclawskie", amazon$city)
amazon$city <- gsub(pattern = "Diego", replacement = "San Diego", amazon$city)
amazon$city <- gsub(pattern = "Barbara", replacement = "Santa Barbara", amazon$city)
amazon$city <- gsub(pattern = "York", replacement = "New York", amazon$city)
amazon$city <- gsub(pattern = "Town", replacement = "Cape Town", amazon$city)
amazon$city <- gsub(pattern = "Cruz", replacement = "Santa Cruz", amazon$city)
amazon$city <- gsub(pattern = "Obispo", replacement = "San Luis Obispo", amazon$city)
amazon$city <- gsub(pattern = "Paulo", replacement = "Sao Paulo", amazon$city)
amazon$city <- gsub(pattern = "Hasharon", replacement = "Hod Hasharon", amazon$city)
amazon$city <- gsub(pattern = "IL,", replacement = "Hod Hasharon", amazon$city)
amazon$city <- gsub(pattern = "On,", replacement = "Ottawa", amazon$city)
amazon$city <- gsub(pattern = "Jose", replacement = "San Jose", amazon$city)
amazon$city <- gsub(pattern = "CA,", replacement = "Ottawa", amazon$city)
amazon$city <- gsub(pattern = "Vegas", replacement = "Las Vegas", amazon$city)
```

The word "City" has been used with three different cities, so include them.

```{r}
amazon$city <- ifelse(amazon$location == "US, CA, Foster City", "Foster City", amazon$city)
amazon$city <- ifelse(amazon$location == "MX, EMEX, Mexico City", "Mexico City", amazon$city)
amazon$city <- ifelse(amazon$location == "US, NJ, Jersey City", "Jersey City", amazon$city)
```

```{r}
head(amazon)
```

# What are most popular locations of Job Openings?

```{r}
library(dplyr)
location <- amazon[, c("country", "city")]
loc1 <- as.data.frame(table(location$city))
colnames(loc1) <- c("city", "Freq")

loc1 <- merge(loc1,location,by="city")
loc1 <- arrange(loc1, desc(Freq))
loc1 <- loc1 %>% distinct(city, .keep_all = TRUE)
loc1
```


```{r fig.width=5, fig.height=3, echo=FALSE}
library(ggplot2)
library(Rmisc)
tilt_theme <- theme(axis.text.x=element_text(angle=45, hjust=1))
p1 <- ggplot(data = head(loc1, 10), aes(city, Freq, fill = country)) +
      geom_bar(stat = "identity") +
      geom_text(aes(label=Freq), color="black", size=3) +
      ggtitle("Top 10 Job Locations") + 
      coord_flip() +
      tilt_theme 
p1
```

```{r fig.width=5, fig.height=3, echo=FALSE}
p2 <- ggplot(data = tail(loc1, 50), aes(city, Freq, fill = country)) +
      geom_bar(stat = "identity") +
      geom_text(aes(label=Freq), color="black", size=3) +
      ggtitle("Last 50 Job Locations") + 
      coord_flip() +
      tilt_theme 
p2
```

Distribution of Jobs in all countries except US
```{r}
p3 <- ggplot(filter(loc1,loc1$country!="US"), aes(x=factor(country), y=Freq, fill = factor(country))) + 
  geom_boxplot() 
p3
```

Distribution of jobs in US

```{r}
p4 <- ggplot(data = filter(loc1, loc1$country == "US"), aes(city, Freq, fill = city)) +
      geom_bar(stat = "identity") +
      geom_text(aes(label=Freq), color="black", size=3) +
      ggtitle("Jobs in US") + 
      coord_flip() +
      guides(fill=FALSE) +
      tilt_theme 
p4
```

# Analysis of Job Posting Date

## How many jobs are posted every year and every month? Is there a certain period of year when jobs are posted more fequently?

```{r}

amazon$Posting_date <- paste(amazon$posting_year, amazon$posting_month, amazon$posting_day,sep="-")

amazon$Posting_date <- strptime(amazon$Posting_date,format="%Y-%b-%d")
amazon$Posting_date$zone <- NULL
amazon$Posting_date[1:10]

#get day of the week based on date
dow <- function(x) format(as.Date(x), "%A")
amazon$weekday <- dow(amazon$Posting_date)
amazon$weekday[1:20]
```

```{r}
posting_date <- amazon[,c("posting_month", "posting_year", "weekday")]
head(posting_date)
```

